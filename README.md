# VK-Education-Highload Курсовая работа
Шишкин А. Ю. WEB-41/31
# RUTUBE
## 1. Тема и Целевая Аудиторияэ
**Тип сервиса**: Видеохостинг
**Местоположение целевой аудитории**: Россия и СНГ

### Основные страны пользователей
|Страна|% Пользователей|
|-|--------|
|Россия|93.3%|
|Казахстан|1.3%|
|Беларусь|1%|
|Украина|0.9%|
[Источник][3]

__Ключевой функционал__: Размещение видео

__Ключевое продуктовое решение__: Рекомендательная система видео

### MVP
* Авторизация
* Загрузка видео
* Просмотр видео (плеер)
* Просмотры и лайки
* Комментарии
* Админ-панель для модерации
* Рекомендации на главной 
* Поиск
* Главная Страница
* Главная Страница
* Страница автора

## 2. Расчёт нагрузки

### Предварительные данные
[**MAU**: 80M][1]

[**DAU**: 20M][1]

**Средняя продолжительность визита: [46 минут][10]**

[**Средняя длина видео**: 12 минут][8]

3.8 Видео за посещение

[**Всего видео на площадке - 388М**][7]

1 минута видео весит 60мб (0.06гб)(1080p, 30fps, 8Мбит/с битрейта).

Общий вес видео на рутубе на данный момент: 388М * 12 * 0.06 = **280 000 ТБ**

[33000М просмотров за полгода][5]

33000M / (6 * 30) = **183М / день** или **2К / секунда**


### RPS
| Тип запроса                                  |    Суточно   | Среднее RPS | Пиковое RPS (Среднее * 3) | Пояснение  |
| -------------------------------------------- | -----------: | ----------: |        ----------:        | ----------:|
| **Просмотр видео**                           |         183M |         ~2K |          ~6K              |            |
| **Стриминг видео**                           |     131 760M |       ~1.4M |          ~4.2M              | 2К запусков видео в секунду * 12*60 длительность видео в секундах, получается больно много, но по цифрам всё так будто |
| **Загрузка видео**                           |         370К |        ~4.3 |          ~13              | ~+135M видео за год => 135М/365 = 370K  |
| **Авторизация**                              |           4M |         ~47 |         ~141              | [4M каналов всего][10] |
| **Комментарии**                              |           1M |         ~12 |          ~36              | 1 коммент на 200 просмотров |
| **Главная Страница**                         |          20M |        ~231 |         ~696              | Каждый из DAU видит главную, хотя кто-то же заходит точечно по ссылке на видео... |
| **Профиль**                                  |          20K |        ~0.2 |         ~0.6              | В дальнейшем такие копейки игнорируем... |
| **Рекомендации**                             |         200M |       ~2.3K |          ~7K              | Каждый раз когда смотрят видео получают рекомендации + копейки с главной |
| **Лайки**                                    |           8M |         ~94 |         ~282              | 4 лайка на 100 просмотров |
| **Медиа (аватарки + превьюшки)**             |        2745M |        ~32K |         ~96K              | На 1м экране просмотра видео умещается 8 рекомендованных видео, округлим до 10 и добавим 5 аватарок пользователей  |


| Тип трафика                                                           | Среднее (Гб/с) | Пиковое (Гб/c) | В сутки (ТБ) | Комментарий                      |
| --------------------------------------------------------------------- | -------------: | -------------: | ------------ | -------------------------------- |
| **Просмотр Видео**                                                    |            ~10 |            ~30 |      864     | 2000 видео/c * 0.005 мб          |
| **Стриминг Видео**                                                    |         ~1 400 |          ~4200 |  362 880     | 1.4M RPS * 1мбит/c               |
| **Загрузка Видео**                                                    |             ~3 |             ~9 |      777     | 4.3 * 12 мин * 0.06 гб/мин       |
| **Медиа**                                                             |            ~64 |           ~192 |   16 588     | 32K RPS * 2мб                    |
| **Итого**                                                             |      **~1507** |      **~4521** | **380 000**  |                                  |
 
# Тут остановился с правками

| Тип трафика          | Объём (GB/сутки) | Как считал                       |
| -------------------- | ---------------: | -------------------------------- |
| **Видео**            |      ~72 036 000 | DAU 20M * 5 просмотров * 0.45 GB |
| **Видео upload**     |       ~8 700 000 | 100 * 24 * 60 * 60               |
| **API / метаданные** |            ~7600 | 304M запросов * 25 KB            |
| **Итого**            |   **~9 668 520** | —                                |

// **общее хранилище и прирост добавить**

## Глобальная балансировка нагрузки
### Функциональное разбиение по доменам
| Домен                                     | Назначение                                         |
| ----------------------------------------- | -------------------------------------------------- |
| **auth.rutube.ru**                        | Авторизация и управление сессиями                  |
| **upload.rutube.ru**                      | Загрузка видео и обработка                         |
| **video.rutube.ru**                       | Отдача видеопотока (плеер)                         |
| **api.rutube.ru**                         | Просмотры, лайки, комментарии, поиск, рекомендации |
| **admin.rutube.ru**                       | Админ-панель и модерация                           |

// добавить ручку для медиа

### Обоснование расположения дата-центров

Москва — основной центр, большая часть аудитории в европейской части РФ.

Санкт-Петербург — разгрузка трафика и резерв.

Екатеринбург — ближе к Уралу и Сибири, уменьшает задержки.

Владивосток / Хабаровск — снижение задержек для Дальнего Востока.

### Расчет распределение запросов
Распределение:

МСК 45%

СПБ 25%

ЕКБ 15%

ДВ 15%

// 

### DNS

Пользователь обращается к rutube.ru.

DNS-сервер на основе геолокации или весов возвращает IP ближайшего дата-центра (Москва, СПБ, Екатеринбург, Владивосток, Казахстан).

При падении центра записи обновляются, запросы уводятся в рабочий ДЦ.

Можно управлять распределением нагрузки через веса в DNS.

### Anycast

Используется для домена video.rutube.ru, так как основной трафик идёт на просмотр видео.

Один IP-адрес объявляется сразу во всех дата-центрах.

Пользователь автоматически подключается к ближайшему узлу маршрутизацией провайдеров.

Это снижает задержку запуска видео и равномерно распределяет трафик.



[1]: https://tass.ru/ekonomika/24311321 "Источник"
[2]: https://inclient.ru/rutube-stats/#rutube3 "Не уверен верить ли источнику"
[3]: https://www.similarweb.com/ru/website/rutube.ru/#demographics "Трафик по странам"
[5]: https://www.cnews.ru/news/line/2025-09-04_dnevnaya_auditoriya_rutube_vyrosla "Последняя статистика по рутубу"
[6]: https://affmaven.com/ru/youtube-statistics/ "Табличка статистики рутуба которую можем спроецировать на рутуб"
[7]: https://habr.com/ru/news/896842/ "388кк видео на рутубе"
[8]: ... "Источника нет, предположение нейронки"
[9]: https://skillbox.ru/media/marketing/mediascope-opublikovala-issledovanie-auditorii-sotsialnykh-media-youtube-poka-eshchye-lider/ "Инфа от медиаскоупа"
[10]: https://habr.com/ru/news/926262/