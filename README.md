# VK-Education-Highload Курсовая работа
Шишкин А. Ю. WEB-41/31
# RUTUBE
## 1. Тема и Целевая Аудиторияэ
**Тип сервиса**: Видеохостинг
**Местоположение целевой аудитории**: Россия и СНГ

### Основные страны пользователей
|Страна|% Пользователей|
|-|--------|
|Россия|93.3%|
|Казахстан|1.3%|
|Беларусь|1%|
|Украина|0.9%|
[Источник][3]

__Ключевой функционал__: Размещение видео

__Ключевое продуктовое решение__: Рекомендательная система видео

### MVP
* Авторизация
* Загрузка видео
* Просмотр видео (плеер)
* Просмотры и лайки
* Комментарии
* Админ-панель для модерации
* Рекомендации на главной 
* Поиск
* Главная Страница
* Главная Страница
* Страница автора

## 2. Расчёт нагрузки

[**MAU**: 80M][1]

[**DAU**: 20M][1]

[**Всего пользователей**: 70M][4]

[**Всего пользователей**: 70M][4]

~~[**Средняя продолжительность визита**: 00:06:57][3]~~ (Источник similarweb)

**Средний размер хранилища пользователя** Информации не нашёл, предположим на 100 пользователей которые только смотрят находится 1 который загружает 1 фильм в FHD MP4 ~80гб (1.5 часа без сжатия из расчёта 0.88гб/минута), с сжатием(за основу беру формат в котором снимает iphone ~65мб/минута) это будет ~5гб.
**Итого ~50МБ/Пользователь**

На фоне затрат памяти на хранение видео, затраты памяти на хранение информации пользователя и комментарии несущественны, но для верности добавим 30мб и тогда

**~200мб/Пользователь**

| Тип запроса                                  | Суточно (шт) | Среднее RPS | Пиковое RPS |
| -------------------------------------------- | -----------: | ----------: | ----------: |
| **Авторизация**                              |          20M |        ~231 |        ~693 |
| **Загрузка видео**                           |         200k |        ~2.3 |          ~7 |
| **Просмотр видео**                           |          20M |        ~231 |      ~3 471 |
| **Лайки**                                    |          10M |        ~116 |      ~1 389 |
| **Комментарии**                              |           4M |         ~46 |        ~139 |
| **Рекомендации на главной**                  |          20M |        ~231 |        ~693 |
| **Поиск**                                    |          60M |        ~694 |      ~3 471 |
| **Главная страница**                         |          20M |        ~231 |        ~693 |
| **Страница автора**                          |          20M |        ~231 |        ~693 |
| **Админ-панель**                             |         100k |        ~1.2 |        ~3.5 |
| **Итого (API+media)**                        |      ~304.3M |  **~3 750** | **~11 250** |

Среднее = Суточно / (24 * 60 * 60)
Пиковое = Среднее * 3

| Тип трафика                                                           | Среднее (Gbps) | Пиковое (Gbps) | Комментарий                      |
| --------------------------------------------------------------------- | -------------: | -------------: | -------------------------------- |
| **Просмотр Видео**                                                    |           ~837 |         ~2 510 | Основная нагрузка                |
| **Загрузка Видео**                                                    |           ~100 |           ~300 | 20M × 0.05 GB / день             |
| **API**                                                               |            ~63 |           ~189 |                                  |
| **Итого**                                                             |       **~902** |     **~2 705** |                                 |

| Тип трафика          | Объём (GB/сутки) | Как считал                       |
| -------------------- | ---------------: | -------------------------------- |
| **Видео**            |      ~72 036 000 | DAU 20M * 5 просмотров * 0.45 GB |
| **Видео upload**     |       ~8 700 000 | 100 * 24 * 60 * 60               |
| **API / метаданные** |            ~7600 | 304M запросов * 25 KB            |
| **Итого**            |   **~9 668 520** | —                                |


## Глобальная балансировка нагрузки
### Функциональное разбиение по доменам
| Домен                                     | Назначение                                         |
| ----------------------------------------- | -------------------------------------------------- |
| **auth.rutube.ru**                        | Авторизация и управление сессиями                  |
| **upload.rutube.ru**                      | Загрузка видео и обработка                         |
| **video.rutube.ru**                       | Отдача видеопотока (плеер)                         |
| **api.rutube.ru**                         | Просмотры, лайки, комментарии, поиск, рекомендации |
| **[www.rutube.ru](http://www.rutube.ru)** | Главная страница, страницы авторов                 |
| **admin.rutube.ru**                       | Админ-панель и модерация                           |

### Обоснование расположения дата-центров

Москва — основной центр, большая часть аудитории в европейской части РФ.

Санкт-Петербург — разгрузка трафика и резерв.

Екатеринбург — ближе к Уралу и Сибири, уменьшает задержки.

Владивосток / Хабаровск — снижение задержек для Дальнего Востока.

Казахстан (Алматы / Астана) — покрытие Центральной Азии и юга Сибири, улучшение качества для СНГ.

### Расчет распределение запросов
Распределение:
МСК 40%
СПБ 20%
ЕКБ 15%
ДВ 15%
Казахстан 10%

DNS
Пользователь обращается к rutube.ru.

DNS-сервер на основе геолокации или весов возвращает IP ближайшего дата-центра (Москва, СПБ, Екатеринбург, Владивосток, Казахстан).

При падении центра записи обновляются, запросы уводятся в рабочий ДЦ.

Можно управлять распределением нагрузки через веса в DNS.

Anycast
Используется для домена video.rutube.ru, так как основной трафик идёт на просмотр видео.

Один IP-адрес объявляется сразу во всех дата-центрах.

Пользователь автоматически подключается к ближайшему узлу маршрутизацией провайдеров.

Это снижает задержку запуска видео и равномерно распределяет трафик.



[1]: https://tass.ru/ekonomika/24311321 "Источник"
[2]: https://inclient.ru/rutube-stats/#rutube3 "Не уверен верить ли источнику"
[3]: https://www.similarweb.com/ru/website/rutube.ru/#demographics "Трафик по странам"
[4]: https://vc.ru/social/1698562-auditoriya-rutube-705-mln-polzovatelei-noyabr-2024-grafik-rosta-po-godam
